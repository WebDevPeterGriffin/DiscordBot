<!doctype html>
<html>
  <head>
    <title>üß† Web Dev Peter Quiz Editor</title>
    <style>
      body {
        font-family: Arial;
        max-width: 500px;
        margin: 2rem auto;
      }
      .option-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
      }
      .option-group input[type="text"] {
        flex: 1;
      }
      button.remove {
        background: red;
        color: white;
        border: none;
        cursor: pointer;
        padding: 2px 6px;
      }
    </style>
  </head>
  <body>
    <h2>üß† <b>Web Dev Peter Quiz Editor</b></h2>

    <label
      >Question<br />
      <input type="text" id="question" required />
    </label>

    <div id="options-container"></div>

    <button id="add-option">+ Add Option</button>

    <br /><br />
    <button onclick="saveQuiz()">üíæ Save Quiz</button>
    <p id="status"></p>

    <script>
      const container = document.getElementById("options-container");
      const addOptionBtn = document.getElementById("add-option");

      let optionCount = 0;
      const maxOptions = 5;
      const minOptions = 2;

      function createOption(label = "", checked = false) {
        if (optionCount >= maxOptions) return;

        const group = document.createElement("div");
        group.className = "option-group";

        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = `Option ${String.fromCharCode(65 + optionCount)}`;
        input.value = label;

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.title = "Correct Answer";
        checkbox.checked = checked;

        const removeBtn = document.createElement("button");
        removeBtn.className = "remove";
        removeBtn.textContent = "‚úñ";
        removeBtn.onclick = () => {
          group.remove();
          optionCount--;
          updateRemoveButtons();
        };

        group.appendChild(input);
        group.appendChild(checkbox);
        group.appendChild(removeBtn);
        container.appendChild(group);

        optionCount++;
        updateRemoveButtons();
      }

      function updateRemoveButtons() {
        const buttons = container.querySelectorAll(".remove");
        buttons.forEach((btn) => {
          btn.disabled = optionCount <= minOptions;
        });
      }

      function saveQuiz() {
        const question = document.getElementById("question").value.trim();
        const groups = container.querySelectorAll(".option-group");

        const options = [];
        const correctAnswers = [];

        groups.forEach((group, i) => {
          const text = group.querySelector('input[type="text"]').value.trim();
          const checked = group.querySelector('input[type="checkbox"]').checked;

          if (text !== "") {
            options.push(text);
            if (checked) {
              correctAnswers.push(String.fromCharCode(65 + i));
            }
          }
        });

        if (!question) {
          return showStatus("‚ùå Question is required", true);
        }

        if (options.length < minOptions || options.length > maxOptions) {
          return showStatus(
            `‚ùå Enter between ${minOptions} and ${maxOptions} options`,
            true,
          );
        }

        if (correctAnswers.length === 0) {
          return showStatus("‚ùå Select at least one correct answer", true);
        }

        fetch("/save-quiz", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            question,
            options,
            answer: correctAnswers,
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.success) {
              showStatus("‚úÖ Quiz saved successfully");
            } else {
              showStatus("‚ùå Failed to save quiz", true);
            }
          });
      }

      function showStatus(msg, error = false) {
        const status = document.getElementById("status");
        status.textContent = msg;
        status.style.color = error ? "red" : "green";
      }

      // Init with 2 options
      createOption();
      createOption();

      addOptionBtn.onclick = () => createOption();
    </script>
  </body>
</html>
